"use strict";var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var a=require("typescript");var d=require("stream");var fs=require("fs");var o=require("chalk");var p=require("path");var q=require("chokidar");var File=require("vinyl");var _=require("lodash");var r=require("glob");var t={none:0,error:1,warn:2,trace:3,info:4};var u=(function(){function u(){}u.d=function(c){this.b=c;};u.f=function(b){this.c=b;};u.g=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}console.log.apply(console,[o.gray("["+this.c+"]")].concat(d));};u.h=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.info){return;}console.log.apply(console,[o.gray(("["+this.c+"]")+o.blue(" INFO: "))].concat(d));};u.j=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.warn){return;}console.log.apply(console,[("["+this.c+"]")+o.yellow(" WARNING: ")].concat(d));};u.k=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.error){return;}console.log.apply(console,[("["+this.c+"]")+o.red(" ERROR: ")].concat(d));};u.l=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i-0]=arguments[_i];}if(this.b<t.error){return;}console.log.apply(console,[("["+this.c+"]")+o.gray(" TRACE: ")].concat(d));};u.b=t.none;u.c="logger";return u;}());var TsCore;(function(TsCore){function b(d,e){var f=d.length;var g=e.length;return f>g&&d.substr(f-g,g)===e;}TsCore.b=b;TsCore.c=[".ts",".tsx",".d.ts"];TsCore.d=TsCore.c;function f(a){if(!a){return false;}for(var _i=0,c_1=TsCore.c;_i<c_1.length;_i++){var d=c_1[_i];if(b(a,d)){return true;}}return false;}TsCore.f=f;function i(b){var c=b.getDeclarations();if(c&&c.length>0){if(c[0].kind===a.SyntaxKind.SourceFile){return c[0].getSourceFile();}}return undefined;}TsCore.i=i;function k(b){if(b.kind===a.SyntaxKind.ImportDeclaration){return b.moduleSpecifier;}if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var c=b.moduleReference;if(c.kind===a.SyntaxKind.ExternalModuleReference){return c.expression;}}if(b.kind===a.SyntaxKind.ExportDeclaration){return b.moduleSpecifier;}}TsCore.k=k;function m(b){var c=[];for(var _i=1;_i<arguments.length;_i++){c[_i-1]=arguments[_i];}var d=b.message;if(arguments.length>1){d=n(d,arguments,1);}return {file:undefined,start:undefined,length:undefined,messageText:d,category:b.category,code:b.code};}TsCore.m=m;function n(a,b,c){c=c||0;return a.replace(/{(\d+)}/g,function(a,d){return b[+d+c];});}function o(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ImportClause&&!!b.name||b.kind===a.SyntaxKind.NamespaceImport||b.kind===a.SyntaxKind.ImportSpecifier||b.kind===a.SyntaxKind.ExportSpecifier||b.kind===a.SyntaxKind.ExportAssignment&&b.expression.kind===a.SyntaxKind.Identifier;}TsCore.o=o;function r(b){return b.replace(/\\/g,"/");}TsCore.r=r;function t(a){return a.replace(/\.ts/,".js");}TsCore.t=t;})(TsCore||(TsCore={}));var Utils;(function(Utils){function b(d,e){if(d){for(var i=0,f=d.length;i<f;i++){var g=e(d[i],i);if(g){return g;}}}return undefined;}Utils.b=b;function c(a,b){if(a){for(var _i=0,a_1=a;_i<a_1.length;_i++){var v=a_1[_i];if(v===b){return true;}}}return false;}Utils.c=c;var d=Object.prototype.hasOwnProperty;function k(e,f){return d.call(e,f);}Utils.k=k;function n(a){var b={};for(var c in a){b[c]=a[c];}return b;}Utils.n=n;function q(b,f){var c;if(b){c=[];for(var _i=0,b_1=b;_i<b_1.length;_i++){var v=b_1[_i];c.push(f(v));}}return c;}Utils.q=q;function t(b,c){var d=1;var f={};for(var g in b){f[g]=b[g];}for(var h in c){if(!k(f,h)){f[h]=c[h];}}return f;}Utils.t=t;function y(b,c,d){return b.substr(0,c)+d+b.substr(c+d.length);}Utils.y=y;})(Utils||(Utils={}));var w=(function(){function w(b,e){this.c=b;this.d=e;}w.prototype.e=function(){return this.d;};w.prototype.f=function(){return this.c;};w.prototype.j=function(){return (this.c===a.ExitStatus.Success);};return w;}());var y=(function(){function y(b){var _this=this;this.c={};this.d={};this.e=0;this.f={};this.i=0;this.m={};this.getSourceFile=this.s;this.fileExists=function(c){c=_this.getCanonicalFileName(c);if(!_this.directoryExists(p.dirname(c))){return false;}if(Utils.k(_this.f,c)){return _this.f[c];}_this.i++;return _this.f[c]=_this.o.fileExists(c);};this.n=b;this.o=a.createCompilerHost(this.n);}y.prototype.r=function(){return this.c;};y.prototype.s=function(b,g,h){return this.o.getSourceFile(b,g,h);};y.prototype.writeFile=function(d,e,f,i){this.c[d]=e;};y.prototype.readFile=function(a){if(Utils.k(this.m,a)){u.l("readFile() cache hit: ",a);return this.m[a];}u.l("readFile() Adding to cache: ",a);return this.m[a]=this.o.readFile(a);};y.prototype.getDefaultLibFileName=function(b){return this.o.getDefaultLibFileName(b);};y.prototype.getCurrentDirectory=function(){return this.o.getCurrentDirectory();};y.prototype.getDirectories=function(a){return this.o.getDirectories(a);};y.prototype.getCanonicalFileName=function(b){return this.o.getCanonicalFileName(b);};y.prototype.useCaseSensitiveFileNames=function(){return this.o.useCaseSensitiveFileNames();};y.prototype.getNewLine=function(){return this.o.getNewLine();};y.prototype.directoryExists=function(b){if(Utils.k(this.d,b)){return this.d[b];}this.e++;return this.d[b]=a.sys.directoryExists(b);};return y;}());var z=(function(_super){__extends(z,_super);function z(a){_super.call(this,{objectMode:true});}z.prototype._read=function(){};return z;}(d.Readable));var A=(function(){function A(){}A.prototype.a=function(b){u.g(b);};A.prototype.b=function(c,d){u.g(this.h(c+":",25)+o.magenta(this.f(d.toString(),10)));};A.prototype.c=function(a,e){this.b(a,""+e);};A.prototype.d=function(f,g){this.b(f,(g/1000).toFixed(2)+"s");};A.prototype.e=function(a,c){this.b(a,c.toFixed(2)+"%");};A.prototype.f=function(s,a){while(s.length<a){s=" "+s;}return s;};A.prototype.h=function(s,a){while(s.length<a){s=s+" ";}return s;};return A;}());var B=(function(_super){__extends(B,_super);function B(a){_super.call(this,a);}return B;}(File));var BundlePackageType;(function(BundlePackageType){BundlePackageType[BundlePackageType["None"]=0]="None";BundlePackageType[BundlePackageType["Library"]=1]="Library";BundlePackageType[BundlePackageType["Component"]=2]="Component";})(BundlePackageType||(BundlePackageType={}));var C=(function(){function C(a,d){this.c=undefined;this.b=a;this.c=d;}C.prototype.d=function(){return this.b;};C.prototype.e=function(){return this.c;};return C;}());var D=(function(){function D(){}D.prototype.b=function(c,d){var f=[];return {bundles:b(),errors:f};function b(){var e=[];var g=c["bundles"];if(g){u.h(g);for(var i in g){u.h("Bundle Id: ",i,g[i]);var j=g[i];var l;var n=[];var o={};l=p.join(d,i);if(Utils.k(j,"files")){if(j["files"] instanceof Array){n=Utils.q(j["files"],function(s){return p.join(d,s);});u.h("bundle files: ",n);}else{f.push(TsCore.m({code:6063,category:a.DiagnosticCategory.Error,key:"Bundle_0_files_is_not_an_array_6063",message:"Bundle '{0}' files is not an array."},i));}}else{f.push(TsCore.m({code:6062,category:a.DiagnosticCategory.Error,key:"Bundle_0_requires_an_array_of_files_6062",message:"Bundle '{0}' requires an array of files."},i));}if(Utils.k(j,"config")){o=j.config;}o.package=v(o);e.push({name:l,fileNames:n,config:o});}}return e;}function v(b){var c=0;var d=undefined;var e={"none":0,"library":1,"component":2};if(Utils.k(b,"package")){var f=b["package"];if(typeof (f)==="string"){if(Utils.k(e,f.toLowerCase())){c=e[f.toLowerCase()];}}}if(Utils.k(b,"packageNamespace")){var g=b["packageNamespace"];if(typeof (g)==="string"){d=g;}}return new C(c,d);}};return D;}());var E=(function(){function E(b,c,f){this.D=0;this.G=0;this.L=0;this.t=b;this.v=c;this.x=f;this.C=this.v.getCompilerOptions();}E.prototype.Q=function(c){this.L=this.D=new Date().getTime();u.g("Compiling project files...");var l=a.getPreEmitDiagnostics(this.v);if(this.C.noEmitOnError&&l.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,l);}this.D=new Date().getTime()-this.D;if(!this.C.noEmit){var m=new Date().getTime();var n=this.v.emit();this.G=new Date().getTime()-m;l=l.concat(n.diagnostics);if(n.emitSkipped){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,l);}var o=this.t.r();for(var p in o){var q=o[p];var s=new B({path:p,contents:new Buffer(q)});this.x.push(s);}}this.L=new Date().getTime()-this.L;if(l.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,l);}if(this.C.diagnostics){this.T();}return new w(a.ExitStatus.Success);};E.prototype.T=function(){var l=new A();l.c("Files",this.v.getSourceFiles().length);l.c("Lines",this.U());l.d("Pre-emit time",this.D);l.d("Emit time",this.G);l.d("Compile time",this.L);};E.prototype.U=function(){var _this=this;var a=0;Utils.b(this.v.getSourceFiles(),function(b){if(!b.isDeclarationFile){a+=_this.V(b).length;}});return a;};E.prototype.V=function(b){return b.getLineStarts();};return E;}());var F=(function(_super){__extends(F,_super);function F(b,c){var _this=this;_super.call(this,b);this.getSourceFile=function(b,c,d){if(_this.j){var f_1=_this.j.getSourceFile(b);if(f_1&&f_1.fileWatcher){u.l("getSourceFile() watcher hit for: ",b);return f_1;}}u.l("getSourceFile() reading source file from fs: ",b);var e=_super.prototype.s.call(_this,b,c,d);if(e&&_this.n.watch){e.fileWatcher=q.watch(e.fileName);e.fileWatcher.on("change",function(a,b){return _this.t(e,a,b);});}return e;};this.t=c;}F.prototype.v=function(d){this.j=d;};return F;}(y));var G=(function(){function G(){}G.prototype.a=function(b){var g=new r.Glob(b);var c=g.minimatch.set ;if(c.length>1)return true;for(var j=0;j<c[0].length;j++){if(typeof c[0][j]!=='string')return true;}return false;};G.prototype.c=function(e,f){if(e.length===0){return [];}var g=this.d(e,function(a){return r.sync(a,{root:f});});return g;};G.prototype.d=function(c,f){var j=[];_.flatten(c).forEach(function(b){var c;var a;c=_.isString(b)&&b.indexOf("!")===0;if(c){b=b.slice(1);}a=f(b);if(c){return j=_.difference(j,a);}else{return j=_.union(j,a);}});return j;};return G;}());var H=(function(){function H(b,d,e){this.c=b;this.l=d;this.n=e;}H.prototype.q=function(){return this.n;};H.prototype.s=function(){return this.l;};H.prototype.t=function(){return this.c;};H.prototype.v=function(){return (this.c===a.ExitStatus.Success);};return H;}());var I=(function(){function I(d,e){this.g={};this.b=d;this.c=e;this.f=this.c.getCompilerOptions();}I.prototype.l=function(c){var f=this;var g={};var j={};function d(c){c.forEach(function(e){var i=f.s(e);var l=f.t(i);var m=f.b.getCanonicalFileName(l.fileName);if(!Utils.k(j,m)){j[m]=true;if(!l.isDeclarationFile){u.h("Walking Import module: ",m);d(f.n(l));}}if(!Utils.k(g,m)){u.h("Getting and adding imports of module file: ",m);g[m]=f.n(l);}});}var o=f.n(c);d(o);var q=f.b.getCanonicalFileName(c.fileName);if(!Utils.k(g,q)){u.h("Adding top level import dependencies for file: ",q);g[q]=o;}return g;};I.prototype.n=function(b){var d=[];var e=this;function g(f){a.forEachChild(f,function(f){if(f.kind===a.SyntaxKind.ImportDeclaration||f.kind===a.SyntaxKind.ImportEqualsDeclaration||f.kind===a.SyntaxKind.ExportDeclaration){var i=TsCore.k(f);if(i&&i.kind===a.SyntaxKind.StringLiteral){var m=e.c.getTypeChecker().getSymbolAtLocation(i);if(m){u.h("Adding import node: ",m.name);d.push(f);}else{u.j("Module symbol not found");}}}else if(f.kind===a.SyntaxKind.ModuleDeclaration&&f.name.kind===a.SyntaxKind.StringLiteral&&(f.flags&a.NodeFlags.Ambient||b.isDeclarationFile)){var n=f;u.h("Processing ambient module declaration: ",n.name.text);g(f.body);}});};u.h("Getting imports for source file: ",b.fileName);g(b);return d;};I.prototype.o=function(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration&&b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference;};I.prototype.q=function(b){return b.moduleReference.expression;};I.prototype.s=function(b){var d=TsCore.k(b);if(d&&d.kind===a.SyntaxKind.StringLiteral){return this.c.getTypeChecker().getSymbolAtLocation(d);}};I.prototype.t=function(b){var c=b.getDeclarations()[0];return c.getSourceFile();};return I;}());var Ast;(function(Ast){(function(ContainerFlags){ContainerFlags[ContainerFlags["None"]=0]="None";ContainerFlags[ContainerFlags["IsContainer"]=1]="IsContainer";ContainerFlags[ContainerFlags["IsBlockScopedContainer"]=2]="IsBlockScopedContainer";ContainerFlags[ContainerFlags["IsControlFlowContainer"]=4]="IsControlFlowContainer";ContainerFlags[ContainerFlags["IsFunctionLike"]=8]="IsFunctionLike";ContainerFlags[ContainerFlags["IsFunctionExpression"]=16]="IsFunctionExpression";ContainerFlags[ContainerFlags["HasLocals"]=32]="HasLocals";ContainerFlags[ContainerFlags["IsInterface"]=64]="IsInterface";ContainerFlags[ContainerFlags["IsObjectLiteralOrClassExpressionMethod"]=128]="IsObjectLiteralOrClassExpressionMethod";ContainerFlags[ContainerFlags["IsContainerWithLocals"]=33]="IsContainerWithLocals";})(Ast.ContainerFlags||(Ast.ContainerFlags={}));var ContainerFlags=Ast.ContainerFlags;function b(c){if(c.kind!==a.SyntaxKind.BinaryExpression){return false;}var d=c;if(d.operatorToken.kind!==a.SyntaxKind.EqualsToken||d.left.kind!==a.SyntaxKind.PropertyAccessExpression){return false;}var e=d.left;if(e.expression.kind===a.SyntaxKind.PropertyAccessExpression){var f=e.expression;if(f.expression.kind===a.SyntaxKind.Identifier&&f.name.text==="prototype"){return true;}}return false;}Ast.b=b;function c(b){if(b){switch(b.kind){case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return true;}}return false;}Ast.c=c;function d(e){return e.kind===a.SyntaxKind.MethodDeclaration&&(e.parent.kind===a.SyntaxKind.ObjectLiteralExpression||e.parent.kind===a.SyntaxKind.ClassExpression);}Ast.d=d;function e(b){if(b&&(b.flags&a.SymbolFlags.Interface)){if(b.valueDeclaration){var c=b.valueDeclaration.flags;return false;}}return false;}Ast.e=e;function f(b){if(b&&(b.flags&a.SymbolFlags.Class)){var c=b.valueDeclaration.flags;if(!(c&a.NodeFlags.Export)){return true;}}return false;}Ast.f=f;function g(b){if(b&&b.valueDeclaration){if(b.valueDeclaration.flags&a.NodeFlags.Abstract){return true;}}return false;}Ast.g=g;function m(f,g){var t=[];function e(b,c){var d=b.types;if(d){for(var _i=0,d_1=d;_i<d_1.length;_i++){var f=d_1[_i];var g=c.getTypeAtLocation(f);var i=g.symbol.valueDeclaration;if(i){var k=i.heritageClauses;if(k){for(var _a=0,k_1=k;_a<k_1.length;_a++){var l=k_1[_a];e(l,c);}}}var j=g.getProperties();for(var _b=0,j_1=j;_b<j_1.length;_b++){var m=j_1[_b];if(Ast.x(m)){t.push(m);}}}}}var v=f.heritageClauses;if(v){for(var _i=0,v_1=v;_i<v_1.length;_i++){var w=v_1[_i];e(w,g);}}return t;}Ast.m=m;function n(b,c){var d=[];var e=b.types;for(var _i=0,e_1=e;_i<e_1.length;_i++){var f=e_1[_i];var g=c.getTypeAtLocation(f);var h=g.getSymbol();if(h.valueDeclaration){if(h.valueDeclaration.flags&a.NodeFlags.Abstract){var i=g.getProperties();for(var _a=0,i_1=i;_a<i_1.length;_a++){var j=i_1[_a];d.push(j);}}}}return d;}Ast.n=n;function o(b,c){var d=[];var e=b.types;for(var _i=0,e_2=e;_i<e_2.length;_i++){var f=e_2[_i];var g=c.getTypeAtLocation(f);var h=g.getProperties();for(var _a=0,h_1=h;_a<h_1.length;_a++){var i=h_1[_a];d.push(i);}}return d;}Ast.o=o;function p(b){if(!b){return undefined;}var c=b.id;if(c===undefined&&b.valueDeclaration){c=b.valueDeclaration.symbol.id;}return c?c.toString():undefined;}Ast.p=p;function q(b){switch(b.kind){case a.SyntaxKind.ClassExpression:case a.SyntaxKind.ClassDeclaration:case a.SyntaxKind.EnumDeclaration:case a.SyntaxKind.ObjectLiteralExpression:case a.SyntaxKind.TypeLiteral:case a.SyntaxKind.JSDocTypeLiteral:case a.SyntaxKind.JSDocRecordType:return 1;case a.SyntaxKind.InterfaceDeclaration:return 1|64;case a.SyntaxKind.JSDocFunctionType:case a.SyntaxKind.ModuleDeclaration:case a.SyntaxKind.TypeAliasDeclaration:return 1|32;case a.SyntaxKind.SourceFile:return 1|4|32;case a.SyntaxKind.MethodDeclaration:if(d(b)){return 1|4|32|8|128;}case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return 1|4|32|8;case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return 1|4|32|8|16;case a.SyntaxKind.ModuleBlock:return 4;case a.SyntaxKind.PropertyDeclaration:return b.initializer?4:0;case a.SyntaxKind.CatchClause:case a.SyntaxKind.ForStatement:case a.SyntaxKind.ForInStatement:case a.SyntaxKind.ForOfStatement:case a.SyntaxKind.CaseBlock:return 2;case a.SyntaxKind.Block:return c(b.parent)?0:2;}return 0;}Ast.q=q;function r(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_2=c;_i<c_2.length;_i++){var d=c_2[_i];if(d.token===a.SyntaxKind.ImplementsKeyword){return d;}}}}return undefined;}Ast.r=r;function s(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_3=c;_i<c_3.length;_i++){var d=c_3[_i];if(d.token===a.SyntaxKind.ExtendsKeyword){return d;}}}}return undefined;}Ast.s=s;function t(b){return a.SyntaxKind.FirstKeyword<=b&&b<=a.SyntaxKind.LastKeyword;}Ast.t=t;function v(b){return a.SyntaxKind.FirstPunctuation<=b&&b<=a.SyntaxKind.LastPunctuation;}Ast.v=v;function w(b){return a.SyntaxKind.FirstTriviaToken<=b&&b<=a.SyntaxKind.LastTriviaToken;}Ast.w=w;function x(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.ExportContext){return true;}c=c.parent;}return false;}Ast.x=x;function y(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.Ambient){return true;}c=c.parent;}return false;}Ast.y=y;})(Ast||(Ast={}));var J=(function(){function J(b,c,d){this.z={};this.B=[];this.C=undefined;this.t=b;this.v=c;this.B=[b];this.z[d.e().toString()]=d;}J.prototype.D=function(){return this.v;};J.prototype.E=function(){return this.v.name;};J.prototype.F=function(){var b=this.v.id;if(b===undefined&&this.v.valueDeclaration){b=this.v.valueDeclaration.symbol.id;}return b?b.toString():undefined;};J.prototype.G=function(){return this.z;};J.prototype.H=function(){return this.B;};J.prototype.I=function(b,c){this.B.push(b);if(!Utils.k(this.z,c.e().toString())){this.z[c.e().toString()]=c;}};J.prototype.O=function(){if((this.v.flags&a.SymbolFlags.Alias)>0){if(this.v.declarations[0].kind===a.SyntaxKind.NamespaceImport){return true;}}return false;};J.prototype.P=function(){if((this.v.flags&a.SymbolFlags.FunctionScopedVariable)>0){var b=this.X();if(b){return true;}}return false;};J.prototype.Q=function(){if((this.v.flags&a.SymbolFlags.BlockScopedVariable)>0){var b=this.X();if(b){return ((b.parent.flags&a.NodeFlags.Let)!==0)||((b.parent.flags&a.NodeFlags.Const)!==0);}}return false;};J.prototype.R=function(){if((this.v.flags&a.SymbolFlags.FunctionScopedVariable)>0){if(this.v.valueDeclaration.kind===a.SyntaxKind.Parameter){return true;}}return false;};J.prototype.S=function(){return Ast.f(this.v);};J.prototype.T=function(){return Ast.e(this.v);};J.prototype.U=function(b){if(this.v.flags&a.SymbolFlags.Function){if(this.v.valueDeclaration.kind===a.SyntaxKind.FunctionDeclaration){var c=this.v.valueDeclaration.flags;if(Ast.x(this.v)||Ast.y(this.v)){return false;}if(!(c&a.NodeFlags.Export)){return true;}if(b){var d=this.v.valueDeclaration;while(d){if(d.flags&a.NodeFlags.Namespace){var e=d.name.text;if(e!==b){return true;}}d=d.parent;}}}}return false;};J.prototype.V=function(){if((this.v.flags&a.SymbolFlags.Method)>0){if(this.v.valueDeclaration===undefined){return false;}var b=this.v.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_4=this.v.parent;if(c_4&&Ast.f(c_4)){if(!Ast.g(c_4)){return true;}}if(c_4&&Ast.e(c_4)){return false;}}return false;};J.prototype.W=function(){if((this.v.flags&a.SymbolFlags.Property)>0){if(this.v.valueDeclaration===undefined){return false;}var b=this.v.valueDeclaration.flags;if((b&a.NodeFlags.Private)>0){return true;}var c_5=this.v.parent;if(c_5&&Ast.f(c_5)){if(!Ast.g(c_5)){return true;}}}return false;};J.prototype.X=function(){switch(this.t.parent.kind){case a.SyntaxKind.VariableDeclaration:return this.t.parent;case a.SyntaxKind.VariableDeclarationList:u.j("VariableDeclaratioList in getVariableDeclaration() - returning null");break;case a.SyntaxKind.VariableStatement:u.j("VariableStatement in getVariableDeclaration() - returning null");break;}return null;};return J;}());var L=(function(){function L(){}L.c=function(){return this.b++;};L.b=1;return L;}());var K=(function(){function K(b,e,h){this.w=[];this.y=undefined;this.A={};this.B={};this.M={};this.N={};this.O=[];this.P=0;this.d=L.c();this.t=e;if(e&2){this.g=b;this.x=true;this.v=h.T();}else{this.f=this.g=b;this.x=false;this.v=this;}this.z=0;}K.prototype.e=function(){return this.d;};K.prototype.R=function(b){this.w.push(b);};K.prototype.S=function(){return this.w;};K.prototype.T=function(){return this.v;};K.prototype.U=function(){if(this.x){return this.v.U();}return this.z++;};K.prototype.V=function(){return this.x?this.g:this.f;};K.prototype.W=function(){if(this.f){switch(this.f.kind){case a.SyntaxKind.ClassDeclaration:return this.f.members;case a.SyntaxKind.EnumDeclaration:return this.f.members;default:u.l("Container::getMembers() unprocessed container kind: ",this.f.kind);}}return undefined;};K.prototype.X=function(){if(this.f&&this.t&32){switch(this.f.kind){case a.SyntaxKind.ModuleDeclaration:return this.f.locals;default:u.j("Container::getLocals() unprocessed container kind: ",this.f.kind);}}return undefined;};K.prototype.Y=function(){return this.x;};K.prototype.Z=function(){if(this.t&(1|33)){return true;}return false;};K.prototype.$=function(b){if(b.flags&a.SymbolFlags.Class){this.y=b;}};K.prototype._=function(){return this.y;};K.prototype.ab=function(a){for(var i=0;i<this.w.length;i++){if(a.e()===this.w[i].e())return true;}return false;};return K;}());var M=(function(){function M(){}M.prototype.walk=function(b){this.visitNode(b);};M.prototype.visitNode=function(b){this.walkChildren(b);};M.prototype.walkChildren=function(b){var _this=this;a.forEachChild(b,function(a){return _this.visitNode(a);});};return M;}());var N=(function(){function N(){this.f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_0123456789";}N.prototype.g=function(a){var b=["do","if","in","for","int","let","new","try","var"];var c;while(true){c=this.t(a++);if(b.indexOf(c)>0){continue;}else{return c;}}};N.prototype.t=function(a){var b=a;var c=this.f[b%54];b=Math.floor(b/54);while(b>0){c+=this.f[b%64];b=Math.floor(b/64);}return c;};return N;}());var Debug;(function(Debug){function a(b,c){if(!b){c=c||"Assertion failed";if(typeof Error!=="undefined"){throw new Error(c);}throw c;}}Debug.a=a;})(Debug||(Debug={}));var O=(function(_super){__extends(O,_super);function O(b,c,d){_super.call(this);this.L=[];this.Y={};this.Z={};this.gb=0;this.hb=0;this.t=b;this.v=b.getTypeChecker();this.x=c;this.z=d;this.L=[];this.bb=new N();}O.prototype.transform=function(c){this.f=c;return this.kb(c);};O.prototype.ib=function(c){this.eb=new Date().getTime();this.cb=c.length;var f="";var j=a.SyntaxKind.Unknown;var n=false;var o;var q=a.createScanner(a.ScriptTarget.ES5,false,a.LanguageVariant.Standard,c);while((o=q.scan())!==a.SyntaxKind.EndOfFileToken){n=false;if(Ast.w(o)){n=true;}if(!n){switch(j){case a.SyntaxKind.FunctionKeyword:if(o===a.SyntaxKind.Identifier){f+=" ";}break;case a.SyntaxKind.BreakKeyword:case a.SyntaxKind.ContinueKeyword:case a.SyntaxKind.ReturnKeyword:case a.SyntaxKind.YieldKeyword:if(o!==a.SyntaxKind.SemicolonToken){f+=" ";}break;case a.SyntaxKind.ElseKeyword:if(o!==a.SyntaxKind.OpenBraceToken){f+=" ";}break;}switch(o){case a.SyntaxKind.CaseKeyword:case a.SyntaxKind.ClassKeyword:case a.SyntaxKind.ConstKeyword:case a.SyntaxKind.DeleteKeyword:case a.SyntaxKind.DoKeyword:case a.SyntaxKind.ExportKeyword:case a.SyntaxKind.GetKeyword:case a.SyntaxKind.ImportKeyword:case a.SyntaxKind.LetKeyword:case a.SyntaxKind.NewKeyword:case a.SyntaxKind.SetKeyword:case a.SyntaxKind.StaticKeyword:case a.SyntaxKind.ThrowKeyword:case a.SyntaxKind.TypeOfKeyword:case a.SyntaxKind.VarKeyword:case a.SyntaxKind.VoidKeyword:f+=q.getTokenText()+" ";break;case a.SyntaxKind.ExtendsKeyword:case a.SyntaxKind.InKeyword:case a.SyntaxKind.InstanceOfKeyword:f+=" "+q.getTokenText()+" ";break;case a.SyntaxKind.PlusToken:case a.SyntaxKind.PlusPlusToken:if((j===a.SyntaxKind.PlusToken)||(j===a.SyntaxKind.PlusPlusToken)){f+=" ";}f+=q.getTokenText();break;case a.SyntaxKind.MinusToken:case a.SyntaxKind.MinusMinusToken:if((j===a.SyntaxKind.MinusToken)||(j===a.SyntaxKind.MinusMinusToken)){f+=" ";}f+=q.getTokenText();break;default:f+=q.getTokenText();break;}}if(!n){j=o;}}this.db=f.length;this.eb=new Date().getTime()-this.eb;if(this.x.diagnostics)this.zb();return f;};O.prototype.visitNode=function(b){if(this.yb(b)){_super.prototype.visitNode.call(this,b);this.xb();}else{switch(b.kind){case a.SyntaxKind.Identifier:var c=b;var d=this.v.getSymbolAtLocation(c);if(!d){d=this.jb(c);}if(d){var e=Ast.p(d);if(e===undefined){if(d.flags&a.SymbolFlags.Transient){u.l("Ignoring transient symbol: ",d.name);break;}else{e=a.getSymbolId(d).toString();u.l("Generated symbol id for: ",d.name,e);}}if(Utils.k(this.Z,e)){u.h("Identifier already added: ",d.name,e);var f=this.Z[e];this.Z[e].I(c,this.wb());if(!Utils.k(this.wb().B,e)){this.wb().N[e]=f;}}else{var g=new J(c,d,this.wb());u.h("Adding new identifier: ",g.E(),g.F());this.wb().B[e]=g;this.Z[e]=g;var i=d.getName();if(i.length===1){g.C=i;this.wb().N[e]=g;}this.gb++;}}else{u.j("Identifier does not have a symbol: ",c.text);}break;}_super.prototype.visitNode.call(this,b);}};O.prototype.jb=function(c){var d=this.wb().V();if(d.kind===a.SyntaxKind.FunctionExpression){if(Ast.b(d.parent)){var e=d.parent.left.expression.expression;var f=this.v.getSymbolAtLocation(e);if(f&&f.members){if(Utils.k(f.members,c.text)){u.h("Symbol obtained from prototype function: ",c.text);return f.members[c.text];}}}}return undefined;};O.prototype.kb=function(b){this.fb=new Date().getTime();this.walk(b);this.lb();this.fb=new Date().getTime()-this.fb;if(this.x.diagnostics)this.Ab();return b;};O.prototype.lb=function(){for(var b in this.Y){var c=this.Y[b];var d=[];var e=[];var f=[];var g=Ast.s(c.V());if(g){d=Ast.n(g,this.v);}var h=Ast.r(c.V());if(h){f=Ast.o(h,this.v);}e=Ast.m(c.V(),this.v);var i=e.concat(d,f);c.O=i;}this.mb(this.ab);};O.prototype.mb=function(b){var c=b._();if(c){var g=this.Y[c.name];if(g){var h=g.W();if(h){this.sb(h,g);}}}this.tb(b);var d=b.W();if(d){this.sb(d,b);}var e=b.X();if(e){this.rb(e,b);}for(var i in b.B){var k=b.B[i];this.nb(k,b);}for(var l in b.M){var m=b.M[l];var n=Ast.p(m);var o=this.Z[n];this.nb(o,b);}var f=b.S();for(var j=0;j<f.length;j++){this.mb(f[j]);}};O.prototype.nb=function(a,c){var _this=this;if(this.ob(a)){var d_2=this.pb(c,a);u.l("Identifier shortened: ",a.E(),d_2);var e=a.G();for(var f in e){var g=e[f];g.A[d_2]=true;}Utils.b(a.H(),function(b){_this.qb(b,d_2);});return;}};O.prototype.ob=function(a){if(a.Q()||a.P()||a.S()||a.T()||a.V()||a.W()||a.U(this.z.package.e())||a.R()||a.O()){u.l("Identifier CAN be shortened: ",a.E());return true;}u.l("Identifier CANNOT be shortened: ",a.E());return false;};O.prototype.pb=function(b,c){if(!c.C){var d=c.E();if(d.length===1){c.C=d;}else{while(true){var e=this.bb.g(b.U());Debug.a(e.length<=d.length);if(!Utils.k(b.A,e)){c.C=e;break;}else{u.l("Generated name was excluded: ",e,d);}}this.hb++;}}else{u.l("Identifier already has shortened name: ",c.E(),c.C);}u.h("Identifier shortened name: ",c.E(),c.C);return c.C;};O.prototype.qb=function(b,c){var g=b.text.length;var j=(b.end-b.pos);var l=b.getLeadingTriviaWidth();for(var m=b.pos+l;m<b.pos+j;m++){if(this.f.text[m]===b.text[0])break;}b.text=c;b.end=m+c.length;for(var i=0;i<g;i++){var n=" ";if(i<c.length){n=c[i];}this.f.text=Utils.y(this.f.text,m+i,n);}};O.prototype.rb=function(b,c){for(var d in b){var e=b[d];var f=Ast.p(e.declarations[0].symbol);if(f){var g=this.Z[f];this.nb(g,c);}else{u.j("Container local does not have a UId");}}};O.prototype.sb=function(b,c){for(var d in b){var e=b[d];var f=e.symbol;if(f){var g=Ast.p(f);if(g){var h=this.Z[g];var i=false;for(var k in c.O){var l=h.D();var m=c.O[k];if(l.name===m.name){i=true;h.C=h.E();break;}}if(!i){this.nb(h,c);}}else{u.j("Container member does not have a UId");}}else{u.j("Container member does not have a symbol.");}}};O.prototype.tb=function(b){var c=b._();if(c){var d=this.Y[c.name];if(d){var e=d.W();if(e){for(var f in e){var g=e[f];var h=g.symbol;var i=Ast.p(h);var j=this.Z[i];if(j&&j.C){b.A[j.C]=true;}}}}}for(var k in b.B){var l=b.B[k];this.vb(l,b);}for(var m in b.M){var n=b.M[m];var o=Ast.p(n);var q=this.Z[o];Debug.a(q!==undefined,"Container classifiable identifier symbol not found.");this.vb(q,b);}};O.prototype.ub=function(c){var d=this.x.target;var e={};function f(b){var c=b.S();for(var i=0;i<c.length;i++){var g=c[i];f(g);}for(var h in b.N){var j=b.N[h];if((!j.Q)||(d===a.ScriptTarget.ES5)){if(!Utils.k(e,j.F())){e[j.F()]=j;}}}}f(c.T());return e;};O.prototype.vb=function(a,b){var c=a.G();for(var d in c){var e=c[d];var f=this.ub(e);for(var g in f){var h=f[g];if(h.C){b.A[h.C]=true;}}}};O.prototype.wb=function(){return this.L[this.L.length-1];};O.prototype.xb=function(){return this.L.pop();};O.prototype.yb=function(b){var c=Ast.q(b);if(c&(1|2)){var d=new K(b,c,this.wb());var e=b.symbol;if(e&&(e.flags&a.SymbolFlags.Class)){var g=Ast.p(e);if(!Utils.k(this.wb().M,g)){this.wb().M[g]=e;}if(!Utils.k(this.Y,e.name)){this.Y[e.name]=d;}var h=Ast.s(b);if(h){var i=this.v.getSymbolAtLocation(h.types[0].expression);d.$(i);}}var f=this.wb();if(!f){this.ab=d;}else{f.R(d);}this.L.push(d);return true;}return false;};O.prototype.zb=function(){var a=new A();a.d("Whitespace time",this.eb);a.e("Whitespace reduction",((this.cb-this.db)/this.cb)*100.00);};O.prototype.Ab=function(){var a=new A();a.d("Minify time",this.fb);a.c("Total identifiers",this.gb);a.c("Identifiers shortened",this.hb);};return O;}(M));var P=(function(){function P(){}P.c=function(d){if(!d){return;}for(var i=0;i<d.length;i++){this.d(d[i]);}};P.d=function(b){if(!b){return;}var c="";if(b.file){var f=a.getLineAndCharacterOfPosition(b.file,b.start);c+=o.gray(b.file.fileName+"("+(f.line+1)+","+(f.character+1)+"): ");}var e;switch(b.category){case a.DiagnosticCategory.Error:e=o.red(a.DiagnosticCategory[b.category].toLowerCase());break;case a.DiagnosticCategory.Warning:e=o.yellow(a.DiagnosticCategory[b.category].toLowerCase());break;default:e=o.green(a.DiagnosticCategory[b.category].toLowerCase());}c+=e+" TS"+o.white(b.code+'')+": "+o.grey(a.flattenDiagnosticMessageText(b.messageText,"\n"));u.g(c);};return P;}());var Q=(function(){function Q(d,h,m){this.k=d;this.y(m);this.n=h;}Q.prototype.w=function(){this.n.compilerOptions.watch||false;};Q.prototype.x=function(){return this.l;};Q.prototype.y=function(d){if(this.l){var e_3=d?d.getSourceFiles():undefined;Utils.b(this.l.getSourceFiles(),function(a){if(!(e_3&&Utils.c(e_3,a))){var b=a;if(b.fileWatcher){b.fileWatcher.unwatch(b.fileName);}}});}this.k.v(d);this.l=d;};return Q;}());var R=(function(){function R(b,c){this.B=0;this.C=0;this.D=0;this.G=0;this.J="";this.K="";this.L={};this.M={};this.N={};this.w=b;this.z=c;}R.prototype.O=function(A){var _this=this;this.t=A;this.G=new Date().getTime();var D=new I(this.w,this.z);var F=p.dirname(A.name);if(A.config.outDir){F=p.join(F,A.config.outDir);}var T=p.join(F,p.basename(A.name));T=TsCore.r(T);this.J="";this.K="";this.L={};this.M={};this.N={};var U=false;var V={};var _loop_1=function(){var $=A.fileNames[Z];u.h(">>> Processing bundle file:",$);var ab=this_1.w.getCanonicalFileName(TsCore.r($));u.h("BundleSourceFileName:",ab);var bb=this_1.z.getSourceFile(ab);if(!bb){var eb=TsCore.m({code:6060,category:a.DiagnosticCategory.Error,key:"Bundle_source_file_0_not_found_6060",message:"Bundle source file '{0}' not found."},ab);return {value:new H(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,[eb])};}if(bb.languageVariant==a.LanguageVariant.JSX){U=true;}var cb=new Date().getTime();var db=D.l(bb);this_1.B+=new Date().getTime()-cb;for(fb in db){if(!Utils.k(V,fb)){V[fb]=db[fb];}}cb=new Date().getTime();u.h("Traversing module dependencies for bundle: ",bb.fileName);for(gb in db){u.h("Walking dependency nodes for module: ",gb);hb=db[gb];hb.forEach(function(b){var c=_this.db(b);var d=TsCore.i(c);if(d&&!d.isDeclarationFile){var e=_this.w.getCanonicalFileName(d.fileName);var f=db[e];if(f){_this.T(b,f);}if(!Utils.k(_this.L,e)){_this._(d);}}else{if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var g=b.name.text;var h=_this.V(b);if(_this.W(h,g)){_this.$(b.getText());}}else{if(b.kind===a.SyntaxKind.ImportDeclaration){_this.X(b);}}}});}this_1._(bb);this_1.C+=new Date().getTime()-cb;};var this_1=this;var fb,gb,hb;for(var Z in A.fileNames){var state_1=_loop_1();if(typeof state_1==="object")return state_1.value;}var W=this.K;if(A.config.package.d()===1){W+="export namespace "+A.config.package.e()+" {\r\n";W+=this.J;W+=" \r\n}";}else{W+=this.J;}var X=U?".tsx":".ts";var Y={path:T+X,extension:X,text:W};this.G=new Date().getTime()-this.G;if(this.z.getCompilerOptions().diagnostics){this.fb();}return new H(a.ExitStatus.Success,undefined,Y);};R.prototype.T=function(b,c){for(var _i=0,c_6=c;_i<c_6.length;_i++){var d=c_6[_i];var e=this.db(d);var f=TsCore.i(e);if(f&&!f.isDeclarationFile){var g=this.w.getCanonicalFileName(f.fileName);var j=this.eb(d);if(this.U(b,j)){if(!Utils.k(this.L,g)){this._(f);}}}}};R.prototype.U=function(b,c){var d=this.db(b);var e=this.z.getTypeChecker().getExportsOfModule(d);for(var _i=0,e_4=e;_i<e_4.length;_i++){var f=e_4[_i];var g=this.z.getTypeChecker().getDeclaredTypeOfSymbol(f);var i=this.z.getTypeChecker().getBaseTypes(g);for(var _a=0,i_2=i;_a<i_2.length;_a++){var j=i_2[_a];var k=j.symbol.getName();if(c.indexOf(k)>=0){u.h("Base class inheritance found",k);return true;}}}return false;};R.prototype.V=function(b){if(b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference){var c=b.moduleReference;return c.expression.text;}else{return b.moduleReference.getText();}};R.prototype.W=function(a,b){if(!Utils.k(this.M,a)){this.M[a]={};}var c=this.M[a];if(!Utils.k(c,b)){c[b]=b;return true;}return false;};R.prototype.X=function(c){var _this=this;if(!c.importClause){return;}var d=c.moduleSpecifier.text;var e="import ";var f=false;var g=false;if(c.importClause){if(c.importClause.name&&this.W(d,c.importClause.name.text)){e+=c.importClause.name.text;f=true;}}if(c.importClause.namedBindings){if(c.importClause.namedBindings.kind===a.SyntaxKind.NamespaceImport){if(this.W(d,c.importClause.namedBindings.name.text)){if(f){e+=", ";}e+="* as ";e+=c.importClause.namedBindings.name.text;g=true;}}else{if(f){e+=", ";}e+="{ ";Utils.b(c.importClause.namedBindings.elements,function(a){if(_this.W(d,a.name.text)){if(!g){g=true;}else{e+=", ";}var b=a.propertyName;if(b){e+=b.text+" as "+a.name.text;}else{e+=a.name.text;}}});e+=" }";}}e+=" from ";e+=c.moduleSpecifier.getText();e+=";";if(f||g){this.$(e);}};R.prototype.Y=function(b){var _this=this;u.h("Processing import statements and export declarations in file: ",b.fileName);var c=b.text;a.forEachChild(b,function(b){if(b.kind===a.SyntaxKind.ImportDeclaration||b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ExportDeclaration){u.h("processImportStatements() found import");var f=TsCore.k(b);if(f&&f.kind===a.SyntaxKind.StringLiteral){var g=_this.z.getTypeChecker().getSymbolAtLocation(f);if((g)&&(_this.bb(g)||_this.cb)){u.h("processImportStatements() removing code module symbol.");c=_this.Z(b.pos,b.end,c);}}}else{if(_this.t.config.package.d()===2){if(b.kind===a.SyntaxKind.ModuleDeclaration){var i_3=b;if(i_3.name.getText()!==_this.t.config.package.e()){if(i_3.flags&a.NodeFlags.Export){u.h("Component namespace not package namespace. Removing export modifier.");var j=i_3.modifiers[0];c=_this.Z(j.pos,j.end,c);}}}else{if(b.flags&a.NodeFlags.Export){var l=b.modifiers[0];c=_this.Z(l.pos,l.end,c);}}}}});return c;};R.prototype.Z=function(a,b,c){var d=b-a;var e="";for(var i=0;i<d;i++){e+=" ";}var f=c.substring(0,a);var g=c.substring(b);return f+e+g;};R.prototype.$=function(a){u.h("Entering emitModuleImportDeclaration()");this.K+=a+"\n";};R.prototype._=function(b){u.h("Entering addSourceFile() with: ",b.fileName);if(this.ab(b)){var c=this.Y(b);this.J+=c+"\n";var d=this.w.getCanonicalFileName(b.fileName);this.L[d]=d;}else{if(!Utils.k(this.N,b.fileName)){u.h("Adding definition file to bundle source context: ",b.fileName);this.N[b.fileName]=b.text;}}};R.prototype.ab=function(b){return (b.kind===a.SyntaxKind.SourceFile&&!b.isDeclarationFile);};R.prototype.bb=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.SourceFile)&&!(c.isDeclarationFile));};R.prototype.cb=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.ModuleDeclaration)&&((c.flags&a.NodeFlags.Ambient)>0));};R.prototype.db=function(b){var c=TsCore.k(b);if(c&&c.kind===a.SyntaxKind.StringLiteral){return this.z.getTypeChecker().getSymbolAtLocation(c);}};R.prototype.eb=function(b){var c=[];var d=b.importClause.namedBindings;if(d){switch(d.kind){case a.SyntaxKind.NamespaceImport:break;case a.SyntaxKind.NamedImports:for(var _i=0,_a=d.elements;_i<_a.length;_i++){var e=_a[_i];c.push(e.getText());}break;}}return c;};R.prototype.fb=function(){var a=new A();a.d("Deps gen time",this.B);a.d("Deps walk time",this.C);a.d("Source gen time",this.G);};return R;}());var S=(function(){function S(b,c,d){this.D=0;this.G=0;this.I=0;this.J={};this.l=b;this.m=c;this.t=d;this.C=this.m.getCompilerOptions();}S.prototype.K=function(z,F){var _this=this;u.g("Compiling bundle...");this.G=this.I=new Date().getTime();var M;var N;var T;var U=[];Utils.b(this.m.getSourceFiles(),function(a){U.push(a.fileName);});var V={};var W;var X=F.minify||false;if(X){var jb_1=p.dirname(z.path);var kb_1=p.basename(z.path,z.extension);M=TsCore.r(p.join(jb_1,kb_1+".min.ts"));}else{M=z.path;}N=z.text;this.J[M]=N;T=a.createSourceFile(M,z.text,this.C.target);U.push(M);Utils.b(this.m.getSourceFiles(),function(a){_this.J[a.fileName]=a.text;});function i(c,d,e,f){V[c]=d;}function j(c,d,e){if(c===M){return T;}var f=W(c,d,e);return f;}W=this.l.getSourceFile;this.l.getSourceFile=j;this.l.writeFile=i;var Y=this.C;Y.declaration=F.declaration||this.C.declaration;Y.sourceMap=F.sourceMap||this.C.sourceMap;Y.noEmit=false;if(X){Y.declaration=false;Y.removeComments=true;}var Z=a.createProgram(U,Y,this.l);var $=a.getPreEmitDiagnostics(Z);this.I=new Date().getTime()-this.I;if(this.C.noEmitOnError&&$.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,$);}if(X){u.g("Minifying bundle...");var lb=new O(Z,Y,F);T=lb.transform(T);}this.D=new Date().getTime();var _=Z.emit(T);this.D=new Date().getTime()-this.D;u.h("Streaming vinyl bundle source: ",M);var ab=new B({path:M,contents:new Buffer(T.text)});this.t.push(ab);var bb=$.concat(_.diagnostics);if(_.emitSkipped){return new w(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,bb);}if(this.C.noEmitOnError&&bb.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,bb);}var cb=p.dirname(z.path);var db=p.basename(z.path,z.extension);var eb=X?".min":"";var fb=TsCore.r(p.join(cb,db+eb+".js"));if(Utils.k(V,fb)){var mb=V[fb];if(X){var ob=new O(Z,Y,F);mb=ob.ib(mb);}u.h("Streaming vinyl js: ",db);var nb=new B({path:fb,contents:new Buffer(mb)});this.t.push(nb);}var gb=TsCore.r(p.join(cb,db+eb+".d.ts"));if(Utils.k(V,gb)){u.h("Streaming vinyl d.ts: ",gb);var pb=new B({path:gb,contents:new Buffer(V[gb])});this.t.push(pb);}var hb=TsCore.r(p.join(cb,db+eb+".js.map"));if(Utils.k(V,hb)){u.h("Streaming vinyl js.map: ",hb);var qb=new B({path:hb,contents:new Buffer(V[hb])});this.t.push(qb);}this.G=new Date().getTime()-this.G;if(this.C.diagnostics)this.L();if(bb.length>0){return new w(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,bb);}else{return new w(a.ExitStatus.Success);}};S.prototype.L=function(){var a=new A();a.d("Pre-emit time",this.I);a.d("Emit time",this.D);a.d("Compile time",this.G);};return S;}());var V=(function(){function V(a,b){var _this=this;this.I=0;this.J=0;this.L=0;this.M=0;this.cb=function(a,b){_this.N=undefined;_this.eb();};this.db=function(a,b,c){a.fileWatcher.unwatch(a.fileName);a.fileWatcher=undefined;_this.eb();};this.fb=function(){_this.U=undefined;var a=_this.ab();_this.kb(a);if(_this.N.n.compilerOptions.watch){u.g("Watching for project changes...");}};this.l=a;this.r=b;}V.prototype.W=function(){return undefined;};V.prototype.X=function(d){var A=this.bb();if(!A.success){P.c(A.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.N=this.Y(A);u.g("Building Project with: "+o.magenta(""+this.C));u.g("TypeScript compiler version: ",a.version);this.w=d;var G=this.ab();this.kb(G);if(A.compilerOptions.watch){u.g("Watching for project changes...");}else{this.$();}return G;};V.prototype.Y=function(V){if(V.compilerOptions.watch){if(!this.Z()){V.compilerOptions.watch=false;}}var W=new F(V.compilerOptions,this.db);return new Q(W,V);};V.prototype.Z=function(){var _this=this;if(!a.sys.watchFile){var b=TsCore.m({code:5001,category:a.DiagnosticCategory.Warning,key:"The_current_node_host_does_not_support_the_0_option_5001",message:"The current node host does not support the '{0}' option."},"-watch");P.d(b);return false;}if(!this.T){this.T=q.watch(this.C);this.T.on("change",function(W,X){return _this.cb(W,X);});}return true;};V.prototype.$=function(){this.w.push(null);};V.prototype.ab=function(){this.I=this.L=new Date().getTime();if(!this.N){var C=this.bb();if(!C.success){P.c(C.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.N=this.Y(C);}var d=[];var h=this.N.n.fileNames;var l=this.N.n.bundles;var m=this.N.n.compilerOptions;var p=a.createProgram(h,m,this.N.k,this.N.x());this.L=new Date().getTime()-this.L;this.N.y(p);var r=new E(this.N.k,p,this.w);this.J=new Date().getTime();var t=r.Q();this.J=new Date().getTime()-this.J;if(!t.j()){P.c(t.e());return t.f();}if(m.listFiles){Utils.b(this.N.x().getSourceFiles(),function(a){u.g(a.fileName);});}this.M=new Date().getTime();var z=new R(this.N.k,this.N.x());var A=new S(this.N.k,this.N.x(),this.w);var B;for(var i=0,D=l.length;i<D;i++){u.g("Building bundle: ",o.cyan(l[i].name));B=z.O(l[i]);if(!B.v()){P.c(B.s());return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}t=A.K(B.q(),l[i].config);if(!t.j()){P.c(t.e());return t.f();}}this.M=new Date().getTime()-this.M;this.I=new Date().getTime()-this.I;if(m.diagnostics){this.lb();}if(d.length>0){return a.ExitStatus.DiagnosticsPresent_OutputsGenerated;}return a.ExitStatus.Success;};V.prototype.bb=function(){var _this=this;try{var o=fs.lstatSync(this.l).isDirectory();}catch(e){var q=TsCore.m({code:6064,category:a.DiagnosticCategory.Error,key:"Cannot_read_project_path_0_6064",message:"Cannot read project path '{0}'."},this.l);return {success:false,errors:[q]};}if(o){this.B=this.l;this.C=p.join(this.l,"tsconfig.json");}else{this.B=p.dirname(this.l);this.C=this.l;}u.h("Reading config file:",this.C);var d=a.readConfigFile(this.C,this.gb);if(d.error){return {success:false,errors:[d.error]};}var f=d.config;u.h("Parsing config file...");var g=a.parseJsonConfigFileContent(f,a.sys,this.B);if(g.errors.length>0){return {success:false,errors:g.errors};}g.fileNames=this.ib(g.fileNames,this.B);if(this.r.convertFiles===true){this.jb(g.fileNames,this.B);}var i=new D();var j=i.b(f,this.B);if(j.errors.length>0){return {success:false,errors:j.errors};}j.bundles.forEach(function(a){a.fileNames=_this.ib(a.fileNames,_this.B);});var k=this.hb(this.r,this.B);if(k.errors.length>0){return {success:false,errors:k.errors};}var n=Utils.t(k.options,g.options);u.h("Compiler options: ",n);return {success:true,compilerOptions:n,fileNames:g.fileNames,bundles:j.bundles};};V.prototype.eb=function(){if(this.U){clearTimeout(this.U);}this.U=setTimeout(this.fb,250);};V.prototype.gb=function(b){return a.sys.readFile(b);};V.prototype.hb=function(b,c){var d=a.parseJsonConfigFileContent(b,a.sys,c);if(d.options.project){var e=TsCore.m({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--project");d.errors.push(e);}return d;};V.prototype.ib=function(d,e){var f=new G();var g=[];Utils.b(d,function(b){if(!f.a(b)){g.push(p.normalize(b));}});var h=f.c(d,e);var i=[];Utils.b(h,function(a){i.push(p.normalize(a));});return _.union(i,g);};V.prototype.jb=function(a,b){var c="";try{c=fs.readFileSync(this.C,'utf8');if(c!==undefined){var d=JSON.parse(c);var f_2=[];a.forEach(function(a){f_2.push(p.relative(b,a).replace(/\\/g,"/"));});d["files"]=f_2;fs.writeFileSync(this.C,JSON.stringify(d,undefined,4));}}catch(e){u.g(o.yellow("Converting project files failed."));}};V.prototype.kb=function(b){switch(b){case a.ExitStatus.Success:u.g(o.green("Project build completed successfully."));break;case a.ExitStatus.DiagnosticsPresent_OutputsSkipped:u.g(o.red("Build completed with errors."));break;case a.ExitStatus.DiagnosticsPresent_OutputsGenerated:u.g(o.red("Build completed with errors. "+o.italic("Outputs generated.")));break;}};V.prototype.lb=function(){var b=new A();b.a("Total build times...");b.d("Pre-build time",this.L);b.d("Compiling time",this.J);b.d("Bundling time",this.M);b.d("Build time",this.I);};return V;}());var TsPackage;(function(TsPackage){function builder(b,c,e){if(b===undefined&&typeof b!=='string'){throw new Error("Provide a valid directory or file path to the Typescript project configuration json file.");}c=c||{};c.logLevel=c.logLevel||0;u.d(c.logLevel);u.f("TsPackage");return new V(b,c);}TsPackage.builder=builder;})(TsPackage=exports.TsPackage||(exports.TsPackage={}));module.exports=TsPackage;